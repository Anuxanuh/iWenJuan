@page "/survey-community"
@inject IDialogService DialogService
@inject IHttpClientFactory httpClientFactory
@inject ILogger<SurveyEditor> Logger

@code {
	private HttpClient _httpClient = default!;
	private List<SearchResultDto> results = [];

	protected override void OnInitialized()
	{
		_httpClient = httpClientFactory.CreateClient("TemplateCommunityService");
	}
}

<PageTitle>问卷模板社区</PageTitle>

<FluentLabel Typo="Typography.H1">问卷模板社区</FluentLabel>

<FluentSearch @bind-Value=searchKey
			  @bind-Value:after=HandleSearchInput
			  Placeholder="输入你想要的模板关键词"
			  style="width: 100%;">
</FluentSearch>

@if (results.Count == 0)
{
	<FluentCard>
		<FluentLabel Typo="Typography.H3">什么都没有哦</FluentLabel>
		<FluentSkeleton Shape="SkeletonShape.Circle"></FluentSkeleton>
	</FluentCard>
}
else
{
	<FluentGrid Justify="JustifyContent.FlexStart">
		@foreach (var result in results)
		{
			<FluentGridItem>
				<SurveyCard Result="result" />
			</FluentGridItem>
		}
	</FluentGrid>
})

@code {
	private string searchKey = string.Empty;

	private async Task HandleSearchInput()
	{
		if (string.IsNullOrWhiteSpace(searchKey))
			return;

		var response = await _httpClient.GetAsync($"api/search?key={searchKey}");

		if (!response.IsSuccessStatusCode)
		{

			return;
		}

		results = await response.Content.ReadFromJsonAsync<List<SearchResultDto>>() ?? [];
	}
}
